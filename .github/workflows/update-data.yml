name: Update Production Data
on:
  # Manuel tetikleme - GitHub'da buton ile Ã§alÄ±ÅŸtÄ±rabilirsiniz
  workflow_dispatch:
    inputs:
      update_reason:
        description: 'GÃ¼ncelleme nedeni'
        required: false
        default: 'Manuel gÃ¼ncelleme'
  
  # Otomatik tetikleme - Her 6 saatte bir
  schedule:
    - cron: '0 */6 * * *'  # 00:00, 06:00, 12:00, 18:00

jobs:
  update-data:
    runs-on: ubuntu-latest
    name: Veri GÃ¼ncelleme Ä°ÅŸi
    
    steps:
    - name: Repository'yi Ä°ndir
      uses: actions/checkout@v4
      
    - name: Mevcut ZamanÄ± Al
      id: timestamp
      run: |
        echo "current_time=$(date +'%d.%m.%Y %H:%M')" >> $GITHUB_OUTPUT
        echo "iso_time=$(date -u +"%Y-%m-%dT%H:%M:%S")" >> $GITHUB_OUTPUT
    
    - name: Test Verisi GÃ¼ncelle
      run: |
        cat > data.json << 'EOF'
        {
          "data": [
            {
              "Ãœretim HaftasÄ±": "$(date +%U)",
              "CRMOrderNo": "AUTO-$(date +%m%d)",
              "KullanÄ±m": "Mutfak",
              "MaÄŸaza": "Migros",
              "MÃ¼ÅŸteri": "Otomatik Test",
              "ModÃ¼l Adet": "$(shuf -i 10-50 -n 1)",
              "Ãœreticiye AktarÄ±m Tarihi": "$(date +'%d.%m.%Y')",
              "Kapak Prg": "Evet",
              "TamamlayÄ±cÄ± Prg": "HayÄ±r",
              "GÃ¶vde Rengi": "Beyaz",
              "Teslim AlÄ±ndÄ± mÄ±?": "HayÄ±r",
              "Lake GidiÅŸ": "$(date -d '+1 day' +'%d.%m.%Y')",
              "Lake Termin": "$(date -d '+5 days' +'%d.%m.%Y')",
              "Lake DÃ¶nÃ¼ÅŸ": "$(date -d '+7 days' +'%d.%m.%Y')",
              "Ä°ndex": "AUTO-1",
              "E/L": "E",
              "Proje TÃ¼rÃ¼": "Otomatik"
            },
            {
              "Ãœretim HaftasÄ±": "$(date +%U)",
              "CRMOrderNo": "AUTO-$(date +%m%d)-2",
              "KullanÄ±m": "Banyo",
              "MaÄŸaza": "Carrefour", 
              "MÃ¼ÅŸteri": "Test Åžirketi",
              "ModÃ¼l Adet": "$(shuf -i 5-30 -n 1)",
              "Ãœreticiye AktarÄ±m Tarihi": "$(date +'%d.%m.%Y')",
              "Kapak Prg": "HayÄ±r",
              "TamamlayÄ±cÄ± Prg": "Evet",
              "GÃ¶vde Rengi": "Gri",
              "Teslim AlÄ±ndÄ± mÄ±?": "HayÄ±r", 
              "Lake GidiÅŸ": "$(date -d '+2 days' +'%d.%m.%Y')",
              "Lake Termin": "$(date -d '+6 days' +'%d.%m.%Y')",
              "Lake DÃ¶nÃ¼ÅŸ": "$(date -d '+8 days' +'%d.%m.%Y')",
              "Ä°ndex": "AUTO-2",
              "E/L": "L",
              "Proje TÃ¼rÃ¼": "Test"
            }
          ],
          "columns": ["Ãœretim HaftasÄ±", "CRMOrderNo", "KullanÄ±m", "MaÄŸaza", "MÃ¼ÅŸteri", "ModÃ¼l Adet", "Ãœreticiye AktarÄ±m Tarihi", "Kapak Prg", "TamamlayÄ±cÄ± Prg", "GÃ¶vde Rengi", "Teslim AlÄ±ndÄ± mÄ±?", "Lake GidiÅŸ", "Lake Termin", "Lake DÃ¶nÃ¼ÅŸ", "Ä°ndex", "E/L", "Proje TÃ¼rÃ¼"],
          "total_rows": 2,
          "original_rows": 2,
          "filtered_rows": 0,
          "last_updated": "${{ steps.timestamp.outputs.iso_time }}",
          "missing_columns": [],
          "auto_updated": true,
          "update_source": "GitHub Actions"
        }
        EOF
        
        echo "âœ… data.json gÃ¼ncellendi: $(date +'%d.%m.%Y %H:%M')"
    
    - name: DeÄŸiÅŸiklikleri Commit Et
      run: |
        git config --local user.email "actions@github.com"
        git config --local user.name "GitHub Actions Bot"
        git add data.json
        
        if git diff --staged --quiet; then
          echo "DeÄŸiÅŸiklik yok, commit atlanÄ±yor"
        else
          git commit -m "ðŸ¤– Otomatik veri gÃ¼ncelleme - ${{ steps.timestamp.outputs.current_time }}"
          git push
          echo "âœ… DeÄŸiÅŸiklikler GitHub'a gÃ¶nderildi"
        fi
    
    - name: GÃ¼ncelleme Ã–zeti
      run: |
        echo "## ðŸ“Š GÃ¼ncelleme Raporu" >> $GITHUB_STEP_SUMMARY
        echo "- **Zaman:** ${{ steps.timestamp.outputs.current_time }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Durum:** âœ… BaÅŸarÄ±lÄ±" >> $GITHUB_STEP_SUMMARY
        echo "- **GÃ¼ncellenen Dosya:** data.json" >> $GITHUB_STEP_SUMMARY
        echo "- **Site URL:** https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}" >> $GITHUB_STEP_SUMMARY
